<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Tragaperras</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
body {
    margin: 0;
    background: #111;
    color: white;
    font-family: 'Press Start 2P', monospace;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

/* ===== CONTENEDOR ===== */
.container {
    display: flex;
    gap: 30px;
}

/* ===== MAQUINA ===== */
.slot-machine {
    background: #222;
    padding: 25px;
    border: 4px solid white;
    text-align: center;
}

.slots {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
}

.slot {
    width: 90px;
    height: 130px;
    border: 3px solid white;
    font-size: 56px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: black;
}

/* ===== COLORES ===== */
.slot[data-num="1"] { color: #aaa; }
.slot[data-num="2"] { color: #4aa3ff; }
.slot[data-num="3"] { color: #4aff7a; }
.slot[data-num="4"] { color: #ffe84a; }
.slot[data-num="5"] { color: #ff9f3a; }
.slot[data-num="6"] { color: #ff4a4a; }
.slot[data-num="7"] { color: #b44aff; }

/* ===== UI ===== */
.controls {
    margin-bottom: 15px;
}

input[type="number"] {
    width: 120px;
    font-size: 14px;
    text-align: center;
}

button {
    font-size: 14px;
    padding: 8px 20px;
    cursor: pointer;
    background: white;
    border: none;
}

button:disabled {
    background: gray;
}

/* ===== SENSELIOS ===== */
.money {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
}

.money img {
    width: 32px;
}

/* ===== DEBUG ===== */
.debug {
    background: #000;
    border: 3px dashed #b44aff;
    padding: 15px;
    display: none;
}

.debug input {
    width: 100px;
    font-size: 12px;
}

/* ===== JACKPOT ===== */
@keyframes flash {
    0% { border-color: white; }
    50% { border-color: #b44aff; }
    100% { border-color: white; }
}

@keyframes shake {
    0% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    50% { transform: translateX(5px); }
    75% { transform: translateX(-5px); }
    100% { transform: translateX(0); }
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

.jackpot {
    animation: flash 0.3s infinite, shake 0.4s;
}

.jackpot .slot {
    animation: pulse 0.6s infinite;
}
</style>
</head>

<body>

<div class="container">

    <!-- ===== MAQUINA ===== -->
    <div class="slot-machine" id="machine">

        <div class="money">
            <img src="senselios.png">
            <span id="money">0</span>
        </div>

        <div class="slots">
            <div class="slot" id="s1">1</div>
            <div class="slot" id="s2">1</div>
            <div class="slot" id="s3">1</div>
        </div>

        <div class="controls">
            <input type="number" id="bet" value="10" min="1">
        </div>

        <button id="spin">GIRAR</button>
    </div>

    <!-- ===== DEBUG ===== -->
    <div class="debug" id="debug">
        <h3>DEBUG</h3>
        <input type="number" id="addMoney" placeholder="+ dinero">
        <button onclick="addDebugMoney()">OK</button><br><br>
        <input type="number" id="force" placeholder="Resultado (1-7)">
    </div>

</div>

<audio id="plac" src="plac.mp3"></audio>

<script>
const CODE = prompt("Introduce tu cÃ³digo:");
const isDebug = CODE === "GodIsHere";
const saveKey = "slot_" + CODE;

let money = 300;
let forced = null;

if (localStorage.getItem(saveKey)) {
    money = JSON.parse(localStorage.getItem(saveKey)).money;
}

const moneyEl = document.getElementById("money");
const betEl = document.getElementById("bet");
const slots = [
    document.getElementById("s1"),
    document.getElementById("s2"),
    document.getElementById("s3")
];
const machine = document.getElementById("machine");
const plac = document.getElementById("plac");

moneyEl.textContent = money;

if (isDebug) document.getElementById("debug").style.display = "block";

function save() {
    localStorage.setItem(saveKey, JSON.stringify({ money }));
}

function weightedRandom() {
    const pool = [
        ...Array(194).fill(1),
        ...Array(194).fill(2),
        ...Array(149).fill(3),
        ...Array(149).fill(4),
        ...Array(147).fill(5),
        ...Array(147).fill(6),
        ...Array(84).fill(7)
    ];
    return pool[Math.floor(Math.random() * pool.length)];
}

function spin() {
    const bet = parseInt(betEl.value);
    if (bet > money || bet <= 0) return;

    money -= bet;
    updateMoney();

    let results = [];

    slots.forEach((slot, i) => {
        const interval = setInterval(() => {
            const n = weightedRandom();
            slot.textContent = n;
            slot.dataset.num = n;
        }, 80);

        setTimeout(() => {
            clearInterval(interval);
            const final = forced ?? weightedRandom();
            slot.textContent = final;
            slot.dataset.num = final;
            results.push(final);
            plac.currentTime = 0;
            plac.play();

            if (results.length === 3) checkWin(bet, results);
        }, 1000 + i * 600);
    });
}

function checkWin(bet, r) {
    if (r[0] === r[1] && r[1] === r[2]) {
        money += bet * 3;
        updateMoney();

        if (r[0] === 7) {
            machine.classList.add("jackpot");
            setTimeout(() => machine.classList.remove("jackpot"), 3000);
        }
    }
}

function updateMoney() {
    moneyEl.textContent = money;
    save();
}

function addDebugMoney() {
    const v = parseInt(document.getElementById("addMoney").value);
    if (!isNaN(v)) {
        money += v;
        updateMoney();
    }
}

document.getElementById("force").addEventListener("input", e => {
    forced = e.target.value ? parseInt(e.target.value) : null;
});

document.getElementById("spin").addEventListener("click", spin);
</script>

</body>
</html>
