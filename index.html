<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Tragaperras 5x3 con Patrones</title>
<style>
    body {
        margin: 0;
        background: #111;
        color: white;
        font-family: monospace;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
    }

    .slot-machine {
        position: relative;
        background: #222;
        padding: 30px;
        border: 4px solid white;
        text-align: center;
    }

    .slots {
        display: grid;
        grid-template-columns: repeat(5, 80px);
        grid-template-rows: repeat(3, 120px);
        gap: 10px;
        justify-content: center;
        position: relative;
    }

    .slot {
        border: 3px solid white;
        font-size: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: black;
        position: relative;
        z-index: 1;
        color: yellow; /* Color de los números */
        font-weight: bold;
    }

    button {
        font-size: 24px;
        padding: 10px 30px;
        cursor: pointer;
        background: white;
        border: none;
        margin-top: 20px;
    }

    canvas {
        position: absolute;
        top: 0;
        left: 0;
        pointer-events: none;
    }
</style>
</head>
<body>

<div class="slot-machine">
    <div class="slots" id="slotsContainer">
        <!-- 15 casillas -->
        <div class="slot" id="slot0">1</div>
        <div class="slot" id="slot1">1</div>
        <div class="slot" id="slot2">1</div>
        <div class="slot" id="slot3">1</div>
        <div class="slot" id="slot4">1</div>

        <div class="slot" id="slot5">1</div>
        <div class="slot" id="slot6">1</div>
        <div class="slot" id="slot7">1</div>
        <div class="slot" id="slot8">1</div>
        <div class="slot" id="slot9">1</div>

        <div class="slot" id="slot10">1</div>
        <div class="slot" id="slot11">1</div>
        <div class="slot" id="slot12">1</div>
        <div class="slot" id="slot13">1</div>
        <div class="slot" id="slot14">1</div>
    </div>
    <button id="spinBtn">GIRAR</button>
    <canvas id="lineCanvas" width="500" height="400"></canvas>
</div>

<script>
const slots = [];
for(let i=0;i<15;i++){
    slots.push(document.getElementById("slot"+i));
}

const spinBtn = document.getElementById("spinBtn");
let intervals = [];

// Probabilidades de los números (1-7)
const probs = [19,19,14.9,14.9,11.9,11.9,8.4];
const numbers = [1,2,3,4,5,6,7];

function getRandomNumber() {
    const rand = Math.random()*100;
    let acc = 0;
    for(let i=0;i<probs.length;i++){
        acc += probs[i];
        if(rand<=acc) return numbers[i];
    }
    return numbers[numbers.length-1];
}

// Patrones
const patrones = [
    // Horizontales
    { nombre: "HOR-1", indices: [0,1,2], multiplicador:1 },
    { nombre: "HOR-2", indices: [1,2,3], multiplicador:1 },
    { nombre: "HOR-3", indices: [2,3,4], multiplicador:1 },
    { nombre: "HOR-4", indices: [5,6,7], multiplicador:1 },
    { nombre: "HOR-5", indices: [6,7,8], multiplicador:1 },
    { nombre: "HOR-6", indices: [7,8,9], multiplicador:1 },
    { nombre: "HOR-7", indices: [10,11,12], multiplicador:1 },
    { nombre: "HOR-8", indices: [11,12,13], multiplicador:1 },
    { nombre: "HOR-9", indices: [12,13,14], multiplicador:1 },
    // Horizontales largas
    { nombre: "HOR-L", indices: [0,1,2,3], multiplicador:2 },
    { nombre: "HOR-L2", indices: [1,2,3,4], multiplicador:2 },
    { nombre: "HOR-XL", indices: [0,1,2,3,4], multiplicador:3 },
    { nombre: "HOR-XL2", indices: [5,6,7,8,9], multiplicador:3 },
    { nombre: "HOR-XL3", indices: [10,11,12,13,14], multiplicador:3 },
    // Verticales
    { nombre: "VER-1", indices: [0,5,10], multiplicador:1 },
    { nombre: "VER-2", indices: [1,6,11], multiplicador:1 },
    { nombre: "VER-3", indices: [2,7,12], multiplicador:1 },
    { nombre: "VER-4", indices: [3,8,13], multiplicador:1 },
    { nombre: "VER-5", indices: [4,9,14], multiplicador:1 },
    // Diagonales
    { nombre: "DIAG-1", indices: [0,6,12], multiplicador:1 },
    { nombre: "DIAG-2", indices: [2,6,10], multiplicador:1 },
    { nombre: "DIAG-3", indices: [4,8,12], multiplicador:1 },
    { nombre: "DIAG-4", indices: [0,7,14], multiplicador:1 },
    { nombre: "DIAG-5", indices: [1,7,13], multiplicador:1 },
    { nombre: "DIAG-6", indices: [3,7,11], multiplicador:1 },
    // Especiales
    { nombre: "ZIG", indices: [2,10,6,8,14], multiplicador:4 },
    { nombre: "ZAG", indices: [0,6,12,8,4], multiplicador:4 },
    { nombre: "ABOVE", indices: [2,10,6,8,14,11,12,13], multiplicador:7 },
    { nombre: "BELOW", indices: [0,6,12,8,4,1,2,3], multiplicador:7 },
    { nombre: "EYE", indices: [1,2,2,5,6,8,9,11,12,13], multiplicador:8 },
    { nombre: "JACKPOT", indices: [...Array(15).keys()], multiplicador:10 }
];

// Canvas
const canvas = document.getElementById("lineCanvas");
const ctx = canvas.getContext("2d");

function drawLine(indices){
    ctx.strokeStyle = "red"; // Color diferente al de los números
    ctx.lineWidth = 6;
    ctx.beginPath();
    for(let i=0;i<indices.length;i++){
        const slot = slots[indices[i]];
        const rect = slot.getBoundingClientRect();
        const parentRect = slot.parentElement.getBoundingClientRect();
        const x = rect.left - parentRect.left + rect.width/2;
        const y = rect.top - parentRect.top + rect.height/2;
        if(i===0) ctx.moveTo(x,y);
        else ctx.lineTo(x,y);
    }
    ctx.stroke();
}

function checkPatterns(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    patrones.forEach(p=>{
        const first = slots[p.indices[0]].textContent;
        if(p.indices.every(idx => slots[idx].textContent === first)){
            drawLine(p.indices);
            console.log("Patrón detectado:",p.nombre,"Multiplicador:",p.multiplicador);
        }
    });
}

function spin(){
    spinBtn.disabled = true;
    intervals.forEach(i=>clearInterval(i));
    intervals=[];
    let stoppedCount = 0;

    slots.forEach((slot,index)=>{
        const interval = setInterval(()=>{
            slot.textContent = getRandomNumber();
        },50);
        intervals.push(interval);

        setTimeout(()=>{
            clearInterval(interval);
            slot.textContent = getRandomNumber();
            stoppedCount++;

            if(stoppedCount===slots.length){
                spinBtn.disabled=false;
                checkPatterns(); // Solo después de que todos se detengan
            }
        },1000 + (index%5)*500); // Frenado por fila
    });
}

spinBtn.addEventListener("click",spin);
</script>

</body>
</html>
