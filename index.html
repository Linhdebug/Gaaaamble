<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Tragaperras</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
    body {
        margin: 0;
        background: #111;
        color: white;
        font-family: 'Press Start 2P', monospace;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
    }

    .hud {
        position: absolute;
        top: 20px;
        right: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 14px;
    }

    .hud img {
        width: 24px;
        height: 24px;
    }

    .slot-machine {
        background: #222;
        padding: 30px;
        border: 4px solid white;
        text-align: center;
    }

    .slots {
        display: flex;
        gap: 20px;
        margin-bottom: 25px;
        justify-content: center;
    }

    .slot {
        width: 80px;
        height: 120px;
        border: 3px solid white;
        font-size: 56px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: black;
    }

    .bet {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        margin-bottom: 20px;
    }

    .bet button {
        font-size: 14px;
        padding: 6px 10px;
        background: #333;
        color: white;
        border: 2px solid white;
        cursor: pointer;
    }

    .bet input {
        width: 100px;
        text-align: center;
        font-size: 14px;
        padding: 6px;
        background: black;
        color: white;
        border: 2px solid white;
        font-family: 'Press Start 2P', monospace;
    }

    #spinBtn {
        font-size: 16px;
        padding: 12px 30px;
        background: white;
        border: none;
        cursor: pointer;
    }

    #spinBtn:disabled {
        background: gray;
    }

    .msg {
        margin-top: 15px;
        font-size: 12px;
    }
</style>
</head>
<body>

<div class="hud">
    <img src="senselios.png">
    <span id="money">0</span>
</div>

<div class="slot-machine">
    <div class="slots">
        <div class="slot" id="s1">1</div>
        <div class="slot" id="s2">1</div>
        <div class="slot" id="s3">1</div>
    </div>

    <div class="bet">
        <button onclick="changeBet(-10)">-</button>
        <input type="number" id="betInput" value="10" min="1">
        <button onclick="changeBet(10)">+</button>
    </div>

    <button id="spinBtn">GIRAR</button>
    <div class="msg" id="msg"></div>
</div>

<script>
/* ================= LOGIN / PARTIDA ================= */

let code = prompt("Introduce tu código:");
if (!code) location.reload();

const saveKey = "save_" + code;

let save = JSON.parse(localStorage.getItem(saveKey));

if (!save) {
    save = { money: 300 };
    localStorage.setItem(saveKey, JSON.stringify(save));
}

let money = save.money;
const moneyEl = document.getElementById("money");
moneyEl.textContent = money;

/* ================= SLOT ================= */

const slots = [
    document.getElementById("s1"),
    document.getElementById("s2"),
    document.getElementById("s3")
];

const plac = new Audio("plac.mp3");
const spinBtn = document.getElementById("spinBtn");
const betInput = document.getElementById("betInput");
const msg = document.getElementById("msg");

function randomNumber() {
    const r = Math.random() * 100;
    if (r < 19.4) return 1;
    if (r < 38.8) return 2;
    if (r < 53.7) return 3;
    if (r < 68.6) return 4;
    if (r < 80.1) return 5;
    if (r < 91.6) return 6;
    return 7;
}

function changeBet(v) {
    betInput.value = Math.max(1, Number(betInput.value) + v);
}

spinBtn.onclick = () => {
    let bet = Number(betInput.value);
    if (bet > money) {
        msg.textContent = "No tienes suficientes Senselios";
        return;
    }

    money -= bet;
    updateMoney();

    spinBtn.disabled = true;
    msg.textContent = "";

    slots.forEach((slot, i) => {
        const interval = setInterval(() => {
            slot.textContent = randomNumber();
        }, 80);

        setTimeout(() => {
            clearInterval(interval);
            slot.textContent = randomNumber();
            plac.currentTime = 0;
            plac.play();

            if (i === 2) finishSpin(bet);
        }, 1000 + i * 600);
    });
};

function finishSpin(bet) {
    const values = slots.map(s => s.textContent);

    if (values[0] === values[1] && values[1] === values[2]) {
        const win = bet * 3;
        money += win;
        msg.textContent = "¡GANAS " + win + "!";
    }

    updateMoney();
    spinBtn.disabled = false;
}

function updateMoney() {
    moneyEl.textContent = money;
    save.money = money;
    localStorage.setItem(saveKey, JSON.stringify(save));
}
</script>

</body>
</html>
