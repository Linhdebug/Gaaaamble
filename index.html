<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Tragaperras 5x3 con Patrones</title>

<!-- Fuente arcade -->
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
    body {
        margin: 0;
        background: #111;
        color: white;
        font-family: monospace;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
    }

    .slot-machine {
        position: relative;
        background: #222;
        padding: 30px;
        border: 4px solid white;
        text-align: center;
    }

    .slots {
        display: grid;
        grid-template-columns: repeat(5, 80px);
        grid-template-rows: repeat(3, 120px);
        gap: 15px;
        margin-bottom: 30px;
        justify-content: center;
        position: relative;
        z-index: 0; /* Slots debajo del canvas */
    }

    .slot {
        border: 3px solid white;
        font-size: 64px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: black;
        font-family: 'Press Start 2P', monospace;
        transition: color 0.2s;
        position: relative;
        z-index: 0;
    }

    button {
        font-size: 24px;
        padding: 10px 30px;
        cursor: pointer;
        background: white;
        border: none;
        margin-top: 20px;
    }

    button:disabled {
        background: gray;
        cursor: not-allowed;
    }

    canvas {
        position: absolute;
        top: 0;
        left: 0;
        pointer-events: none;
        image-rendering: pixelated; /* pixelado retro */
        z-index: 2; /* encima de los slots */
    }
</style>
</head>
<body>

<div class="slot-machine">
    <div class="slots" id="slots-container"></div>
    <button id="spinBtn">GIRAR</button>
    <canvas id="patternCanvas" width="500" height="400"></canvas>
</div>

<script>
const columnas = 5;
const filas = 3;
const slotsContainer = document.getElementById("slots-container");
const slots = [];

// Crear los 5x3 slots automáticamente
for (let r = 0; r < filas; r++) {
    for (let c = 0; c < columnas; c++) {
        const div = document.createElement("div");
        div.classList.add("slot");
        div.textContent = 1;
        slotsContainer.appendChild(div);
        slots.push(div);
    }
}

const spinBtn = document.getElementById("spinBtn");
const plac = new Audio("plac.mp3");
const paternSound = new Audio("patern.mp3"); // sonido patrón

// Función random con probabilidades
function randomNumber() {
    const rand = Math.random() * 100;
    if (rand < 19) return 1;
    else if (rand < 38) return 2;
    else if (rand < 52.9) return 3;
    else if (rand < 67.8) return 4;
    else if (rand < 79.7) return 5;
    else if (rand < 91.6) return 6;
    else return 7;
}

// Función para asignar color según número
function colorNumber(num) {
    switch(num) {
        case 1: return "#FF0000"; // rojo
        case 2: return "#FF7F00"; // naranja
        case 3: return "#FFFF00"; // amarillo
        case 4: return "#00FF00"; // verde
        case 5: return "#0000FF"; // azul
        case 6: return "#8B00FF"; // morado
        case 7: return "#FF1493"; // rosa
        default: return "#FFFFFF"; // blanco por defecto
    }
}

// Canvas para dibujar patrones
const canvas = document.getElementById("patternCanvas");
const ctx = canvas.getContext("2d");

// Definición de patrones (ejemplo reducido, puedes agregar todos)
const patrones = [
    { nombre: "Hor", indices:[[0,1,2],[1,2,3],[2,3,4],[5,6,7],[6,7,8],[7,8,9],[10,11,12],[11,12,13],[12,13,14]] },
    { nombre: "Ver", indices:[[0,5,10],[1,6,11],[2,7,12],[3,8,13],[4,9,14]] },
    { nombre: "Hor-L", indices:[[0,1,2,3],[1,2,3,4],[5,6,7,8],[6,7,8,9],[10,11,12,13],[11,12,13,14]] },
    { nombre: "Hor-XL", indices:[[0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14]] }
];

// Función para dibujar línea sobre patrón
function drawPattern(indices){
    ctx.strokeStyle = "gold";  // color dorado
    ctx.lineWidth = 12;         // línea más gruesa
    ctx.beginPath();
    indices.forEach((i,j)=>{
        const rect = slots[i].getBoundingClientRect();
        const parentRect = slotsContainer.getBoundingClientRect();
        const x = rect.left - parentRect.left + rect.width/2;
        const y = rect.top - parentRect.top + rect.height/2;
        if(j===0) ctx.moveTo(x,y);
        else ctx.lineTo(x,y);
    });
    ctx.stroke();
    // sonido patrón
    paternSound.currentTime = 0;
    paternSound.play();
}

// Revisar patrones
function checkPatterns(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    patrones.forEach(p=>{
        p.indices.forEach(group=>{
            const first = slots[group[0]].textContent;
            if(group.every(idx=>slots[idx].textContent===first)){
                drawPattern(group);
                console.log("Patrón detectado:",p.nombre);
            }
        });
    });
}

// Función para girar
function spin() {
    spinBtn.disabled = true;

    const intervals = slots.map(slot => setInterval(() => {
        const num = randomNumber();
        slot.textContent = num;
        slot.style.color = colorNumber(num);
    }, 50));

    // Frenar cada columna escalonada
    let stoppedCols = 0;

    for (let col = 0; col < columnas; col++) {
        setTimeout(() => {
            for (let fila = 0; fila < filas; fila++) {
                const idx = fila*columnas + col;
                clearInterval(intervals[idx]);
                const num = randomNumber();
                slots[idx].textContent = num;
                slots[idx].style.color = colorNumber(num);
                plac.currentTime = 0;
                plac.play();
            }
            stoppedCols++;
            if(stoppedCols===columnas){
                spinBtn.disabled = false;
                checkPatterns(); // Detectar patrones solo al final
            }
        }, 1000 + col*800);
    }
}

spinBtn.addEventListener("click", spin);
</script>

</body>
</html>
